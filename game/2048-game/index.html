<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2048 Oyunu</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Hücrelerin rengini 2048 stiline benzetmek için */
    .tile {
      transition: all 0.3s ease;
      font-weight: 700;
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: #776e65;
    }
    .tile-0 { background: #cdc1b4; }
    .tile-2 { background: #eee4da; }
    .tile-4 { background: #ede0c8; }
    .tile-8 { background: #f2b179; color: #f9f6f2; }
    .tile-16 { background: #f59563; color: #f9f6f2; }
    .tile-32 { background: #f67c5f; color: #f9f6f2; }
    .tile-64 { background: #f65e3b; color: #f9f6f2; }
    .tile-128 { background: #edcf72; color: #f9f6f2; font-size: 1.3rem; }
    .tile-256 { background: #edcc61; color: #f9f6f2; font-size: 1.3rem; }
    .tile-512 { background: #edc850; color: #f9f6f2; font-size: 1.3rem; }
    .tile-1024 { background: #edc53f; color: #f9f6f2; font-size: 1.1rem; }
    .tile-2048 { background: #edc22e; color: #f9f6f2; font-size: 1.1rem; }
  </style>
</head>
<body class="bg-gradient-to-tr from-yellow-200 via-yellow-300 to-yellow-400 min-h-screen flex flex-col items-center justify-center p-4">

  <h1 class="text-3xl font-bold mb-6 text-yellow-900 select-none">2048 Oyunu</h1>

  <div class="bg-yellow-100 rounded-lg p-4 shadow-lg w-full max-w-md">
    <div class="flex justify-between items-center mb-4">
      <div class="text-xl font-semibold text-yellow-900">Skor: <span id="score">0</span></div>
      <button id="restartBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded transition select-none">Yeniden Başlat</button>
    </div>

    <div id="gameBoard" class="grid grid-cols-4 gap-3 bg-yellow-300 rounded-lg p-3">
      <!-- 16 hücre buraya JS ile eklenecek -->
    </div>

    <div id="gameMessage" class="mt-4 text-center text-yellow-900 font-semibold text-lg select-none"></div>
  </div>

  <script>
    const boardSize = 4;
    let board = [];
    let score = 0;

    const gameBoard = document.getElementById('gameBoard');
    const scoreEl = document.getElementById('score');
    const gameMessage = document.getElementById('gameMessage');
    const restartBtn = document.getElementById('restartBtn');

    // Başlangıçta boş board ve 2 rastgele hücreye 2 veya 4 koy
    function initGame() {
      board = [];
      score = 0;
      scoreEl.textContent = score;
      gameMessage.textContent = "";
      for(let i=0; i<boardSize*boardSize; i++) board.push(0);
      addRandomTile();
      addRandomTile();
      drawBoard();
    }

    // Random boş hücreye 2 ya da 4 koy
    function addRandomTile() {
      const emptyIndices = board.map((v,i) => v === 0 ? i : -1).filter(i => i !== -1);
      if(emptyIndices.length === 0) return;
      const randIndex = emptyIndices[Math.floor(Math.random()*emptyIndices.length)];
      board[randIndex] = Math.random() < 0.9 ? 2 : 4;
    }

    // Boardu güncelle ve render et
    function drawBoard() {
      gameBoard.innerHTML = '';
      for(let i=0; i < board.length; i++) {
        const val = board[i];
        const tile = document.createElement('div');
        tile.classList.add('tile', `tile-${val}`);
        tile.style.height = '60px';
        tile.style.userSelect = 'none';
        tile.textContent = val === 0 ? '' : val;
        gameBoard.appendChild(tile);
      }
    }

    // Hareket işlemleri
    function slide(row) {
      let arr = row.filter(v => v !== 0);
      for(let i=0; i<arr.length-1; i++) {
        if(arr[i] === arr[i+1]) {
          arr[i] *= 2;
          score += arr[i];
          arr[i+1] = 0;
          i++;
        }
      }
      arr = arr.filter(v => v !== 0);
      while(arr.length < boardSize) arr.push(0);
      return arr;
    }

    // Yukarı, aşağı, sola, sağ hareket fonksiyonları
    function moveLeft() {
      let moved = false;
      for(let r=0; r<boardSize; r++) {
        let row = board.slice(r*boardSize, r*boardSize + boardSize);
        let newRow = slide(row);
        if(newRow.toString() !== row.toString()) moved = true;
        for(let c=0; c<boardSize; c++) board[r*boardSize + c] = newRow[c];
      }
      return moved;
    }

    function moveRight() {
      let moved = false;
      for(let r=0; r<boardSize; r++) {
        let row = board.slice(r*boardSize, r*boardSize + boardSize).reverse();
        let newRow = slide(row);
        newRow.reverse();
        if(newRow.toString() !== board.slice(r*boardSize, r*boardSize + boardSize).toString()) moved = true;
        for(let c=0; c<boardSize; c++) board[r*boardSize + c] = newRow[c];
      }
      return moved;
    }

    function moveUp() {
      let moved = false;
      for(let c=0; c<boardSize; c++) {
        let col = [];
        for(let r=0; r<boardSize; r++) col.push(board[r*boardSize + c]);
        let newCol = slide(col);
        if(newCol.toString() !== col.toString()) moved = true;
        for(let r=0; r<boardSize; r++) board[r*boardSize + c] = newCol[r];
      }
      return moved;
    }

    function moveDown() {
      let moved = false;
      for(let c=0; c<boardSize; c++) {
        let col = [];
        for(let r=0; r<boardSize; r++) col.push(board[r*boardSize + c]);
        col.reverse();
        let newCol = slide(col);
        newCol.reverse();
        if(newCol.toString() !== col.reverse().toString()) moved = true;
        for(let r=0; r<boardSize; r++) board[r*boardSize + c] = newCol[r];
      }
      return moved;
    }

    // Oyun bitti kontrolü
    function isGameOver() {
      if(board.includes(0)) return false;
      // Hareket ettirilebilecek komşu var mı kontrolü
      for(let r=0; r<boardSize; r++) {
        for(let c=0; c<boardSize-1; c++) {
          if(board[r*boardSize+c] === board[r*boardSize+c+1]) return false;
        }
      }
      for(let c=0; c<boardSize; c++) {
        for(let r=0; r<boardSize-1; r++) {
          if(board[r*boardSize+c] === board[(r+1)*boardSize+c]) return false;
        }
      }
      return true;
    }

    // Oyun mesajı göster
    function showMessage(msg) {
      gameMessage.textContent = msg;
    }

    // Oyun hareketlerini yap ve güncelle
    function makeMove(direction) {
      let moved = false;
      switch(direction) {
        case 'left': moved = moveLeft(); break;
        case 'right': moved = moveRight(); break;
        case 'up': moved = moveUp(); break;
        case 'down': moved = moveDown(); break;
      }
      if(moved) {
        addRandomTile();
        drawBoard();
        scoreEl.textContent = score;
        if(isGameOver()) {
          showMessage("Oyun bitti! Yeniden başlat.");
        } else {
          showMessage("");
        }
      }
    }

    // Klavye ok tuşlarını dinle
    window.addEventListener('keydown', e => {
      if(gameMessage.textContent.includes("Oyun bitti")) return; // oyun bittiyse ignore
      switch(e.key) {
        case 'ArrowLeft': makeMove('left'); e.preventDefault(); break;
        case 'ArrowRight': makeMove('right'); e.preventDefault(); break;
        case 'ArrowUp': makeMove('up'); e.preventDefault(); break;
        case 'ArrowDown': makeMove('down'); e.preventDefault(); break;
      }
    });

    // Dokunmatik hareketleri algılamak için basit swipe algılama
    let touchStartX = 0;
    let touchStartY = 0;
    window.addEventListener('touchstart', e => {
      const touch = e.changedTouches[0];
      touchStartX = touch.screenX;
      touchStartY = touch.screenY;
    });
    window.addEventListener('touchend', e => {
      if(gameMessage.textContent.includes("Oyun bitti")) return;
      const touch = e.changedTouches[0];
      const dx = touch.screenX - touchStartX;
      const dy = touch.screenY - touchStartY;
      if(Math.abs(dx) > Math.abs(dy)) {
        if(dx > 30) makeMove('right');
        else if(dx < -30) makeMove('left');
      } else {
        if(dy > 30) makeMove('down');
        else if(dy < -30) makeMove('up');
      }
    });

    // Yeniden başlatma butonu
    restartBtn.addEventListener('click', () => {
      initGame();
    });

    // İlk oyun başlatma
    initGame();
  </script>

</body>
</html>
